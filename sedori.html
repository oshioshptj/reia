<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>せどり判定（楽天API）</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  input, button { padding: 8px; font-size: 16px; width: 100%; margin-bottom: 10px; }
  .result { margin-top: 20px; padding: 15px; border-radius: 8px; }
  .good { background: #e0f7e9; }
  .maybe { background: #fff7d6; }
  .bad { background: #ffe0e0; }
</style>
</head>
<body>

<h2>楽天せどり判定</h2>

<input id="jan" placeholder="JANコード">
<input id="cost" type="number" placeholder="仕入れ値（円）">
<button onclick="check()">判定する</button>

<div id="result"></div>

<script>
const APP_ID = "1004732110586681240";

function check() {
  const jan = document.getElementById("jan").value;
  const cost = Number(document.getElementById("cost").value);
  const result = document.getElementById("result");

  result.innerHTML = "検索中…";

  const callbackName = "rakutenCallback_" + Date.now();

  window[callbackName] = function(data) {
    if (!data.Items || data.Items.length === 0) {
      result.innerHTML = "商品が見つかりません";
      return;
    }

    const item = data.Items[0].Item;
    const rakutenPrice = item.itemPrice;
    const sellPrice = Math.floor(rakutenPrice * 1.15);
    const profit = Math.floor(sellPrice * 0.9 - cost);

    let cls = "bad";
    let label = "✕ スルー";
    if (profit >= 1000) { cls = "good"; label = "◎ 買い"; }
    else if (profit >= 300) { cls = "maybe"; label = "△ 好きなら"; }

    result.className = `result ${cls}`;
    result.innerHTML = `
      <b>${item.itemName}</b><br><br>
      楽天最安：¥${rakutenPrice}<br>
      想定売値：¥${sellPrice}<br>
      利益：¥${profit}<br><br>
      <b>${label}</b>
    `;

    delete window[callbackName];
  };

  const script = document.createElement("script");
  script.src =
    "https://app.rakuten.co.jp/services/api/IchibaItem/Search/20170706"
    + "?applicationId=" + APP_ID
    + "&jan=" + jan
    + "&hits=1"
    + "&sort=+itemPrice"
    + "&callback=" + callbackName;

  document.body.appendChild(script);
}
</script>

</body>
</html>
